<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Instructions</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
      }
      .instructions-container {
        background: white;
        padding: 40px;
        border-radius: 15px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        max-width: 800px;
        width: 90%;
        text-align: center;
      }
      h1 {
        font-size: 2em;
        color: #333;
        margin-bottom: 20px;
      }
      .step {
        display: flex;
        align-items: center;
        text-align: left;
        font-size: 1.3em;
        margin: 30px 0;
      }
      .step img {
        width: 60px;
        height: 60px;
        margin-right: 20px;
      }
      p {
        font-size: 1.2em;
        color: #555;
      }
      .cta {
        font-size: 1.5em;
        font-weight: bold;
        margin-top: 30px;
        color: #007bff;
      }
      .button-container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }
      button {
        padding: 15px 25px;
        font-size: 1.3em;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background-color 0.3s ease;
        background-color: #007bff;
        color: white;
      }
      button:hover:not(:disabled) {
        background-color: #0056b3;
        transform: translateY(-1px);
      }
      button:disabled {
        background-color: #6c757d;
        cursor: not-allowed;
        transform: none;
      }
      /* Error message styling */
      .error-message {
        background: #f8d7da;
        color: #721c24;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body>
    <div class="instructions-container">
      <h1>How the Tasks Page Works</h1>
      <div class="step">
        <img
          src="https://cdn-icons-png.flaticon.com/512/1828/1828817.png"
          alt="Step 1"
        />
        <p>
          On the following tasks page, you will see a series of videos. Once
          you've finished watching a video, click the 'Next Task' button to post
          your thoughts on the social media platform. Make sure once you're done
          you press the "Post" button. Now navigate back to the tasks page, and
          repeat the process.
        </p>
      </div>
      <div class="step">
        <img
          src="https://cdn-icons-png.flaticon.com/512/1828/1828817.png"
          alt="Step 2"
        />
        <p>
          You will have to make a total of 18 posts (3 videos on 3 platforms,
          with 2 complete cycles = 18). Since the videos repeat, you don't have
          to re-watch them unless you choose to do so.
        </p>
      </div>
      <p class="cta">Are you ready? Begin!</p>

      <div class="button-container">
        <button id="start-button" onclick="goToTasks()">
          Go to Tasks
        </button>
      </div>
    </div>

    <!-- Import our shared utilities -->
    <script src="../../utils/common.js"></script>
    
    <script>
      // Initialize when page loads
      window.addEventListener('load', function() {
        console.log('Instructions page loaded');
        initializePage();
      });

      function initializePage() {
        try {
          // Verify we have a user ID from the previous page
          const userId = NavigationManager.getQueryParam('user_id');
          if (!userId) {
            FormValidator.showError('Session not found. Please start from the beginning.');
            setTimeout(() => {
              window.location.href = 'consent.html';
            }, 3000);
            return;
          }

          console.log('User ID verified:', userId);
          
          // Store in cookie for consistency
          SecureCookieManager.setCookie('user_id', userId);
          
        } catch (error) {
          console.error('Failed to initialize instructions page:', error);
          FormValidator.showError('Failed to initialize page. Please try again.');
        }
      }

      function goToTasks() {
        const startButton = document.getElementById('start-button');
        
        try {
          // Get user ID
          const userId = NavigationManager.getQueryParam('user_id') || 
                         SecureCookieManager.getCookie('user_id');
          
          if (!userId) {
            FormValidator.showError('User ID not found. Please start from the beginning.');
            return;
          }

          // Show loading state
          startButton.disabled = true;
          startButton.textContent = 'Loading...';

          console.log('Navigating to tasks with user ID:', userId);
          
          // Navigate to tasks page
          NavigationManager.navigateWithUserId('tasks.html', userId);

        } catch (error) {
          console.error('Failed to navigate to tasks:', error);
          FormValidator.showError('Failed to start tasks. Please try again.');
          
          // Reset button
          startButton.disabled = false;
          startButton.textContent = 'Go to Tasks';
        }
      }

      // Error handling
      window.addEventListener('unhandledrejection', function(event) {
        console.error('Unhandled promise rejection:', event.reason);
        FormValidator.showError('An unexpected error occurred. Please try again.');
      });

      window.addEventListener('error', function(event) {
        console.error('JavaScript error:', event.error);
        FormValidator.showError('An unexpected error occurred. Please try again.');
      });
    </script>
  </body>
</html>